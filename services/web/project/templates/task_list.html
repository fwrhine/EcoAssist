{% extends "base.html" %}

{% block content %}
<div class='wrapper'>
  <h1 style="display:inline">Tasks</h1>
  {% if session['role'] == 'teacher' %}
  <button class="btn-icon" onclick="location.href='{{ url_for('create_task') }}'"><i class="fa fa-plus"></i></button>
  {% endif %}
  <br>
  <br>
  {% for task in tasks %}
  <div class="task">
    <h3>{{task.0.task_name}}</h3>
    <h4>{{task.0.points}} points</h4>
    <p>{{task.0.task_detail}}</p>
    {% if session['role'] == 'teacher' %}
    <p>Assigned to: Class {{task.1}}<p>
    {% endif %}
    <form method="post">
      {% if session['role'] == 'student' %}
        {% if task.2 %}
        <button class="btn-task task-button completed" name="task-complete" id="{{task.0.task_id}}" type="button">Task Complete</button>
        {% else %}
        <button class="btn-task task-button" name="task-complete" id="{{task.0.task_id}}" type="button">Task Complete</button>
        {% endif %}
      {% endif %}
        <button class="btn-task" onclick="location.href='{{ url_for('learn') }}/{{task.0.resource_id}}'" name="learn-more" type="button">Learn More</button>
    </form>
  </div>
  {% endfor %}
</div>

{% block javascript %}
<script>
  $(function(){
  	$('button[name ="task-complete"]').click(function(){
  		var id = this.id;
      var self = this;
  		$.ajax({
  			url: '/task-completed',
  			data: {
          task_id: id,
        },
  			type: 'POST',
  			success: function(response){
          $(self).toggleClass("completed");
          // $(self).html("Task Completed")
          console.log(response)
  			},
  			error: function(error){
  				console.log(error);
  			}
  		});
  	});
  });
</script>
{% endblock %}
{% endblock %}
